
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Using GLS in R &#8212; Estimating Covariance Structures and Generalised Least Squares</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/test.css?v=a80109f0" />
    <link rel="stylesheet" type="text/css" href="_static/sphericity_3d_files/rglwidgetClass-1.3.18/rgl.css?v=57907efa" />
    <link rel="stylesheet" type="text/css" href="_static/sphericity_3d_files/htmltools-fill-0.5.8.1/fill.css?v=971cc1da" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '4.gls-R';</script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/textures.src.js?v=9482728f"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/shadersrc.src.js?v=6ce05c17"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/buffer.src.js?v=1efca185"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/mouse.src.js?v=96f0b970"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/projection.src.js?v=98871b91"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/axes.src.js?v=3250d244"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/rglTimer.src.js?v=ac1c3151"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/pretty.src.js?v=4f2cffba"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/shaders.src.js?v=bbbdf37d"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/animation.src.js?v=74f9b9e8"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/pieces.src.js?v=280fd571"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/selection.src.js?v=5b47ed7d"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/init.src.js?v=f5bdcbbb"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/subscenes.src.js?v=42cb429d"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/controls.src.js?v=4b3dbe6f"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/draw.src.js?v=49d9cbaa"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/utils.src.js?v=56efe719"></script>
    <script src="_static/sphericity_3d_files/rglwidgetClass-1.3.18/rglClass.src.js?v=9e593197"></script>
    <script src="_static/sphericity_3d_files/rglWebGL-binding-1.3.18/rglWebGL.js?v=8cd6f6d7"></script>
    <script src="_static/sphericity_3d_files/htmlwidgets-1.6.4/htmlwidgets.js?v=175713be"></script>
    <script src="_static/sphericity_3d_files/CanvasMatrix4-1.3.18/CanvasMatrix.src.js?v=5a2d04be"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Limitations of the GLS Framework" href="5.gls-limitations.html" />
    <link rel="prev" title="Generalised Least Squares (GLS)" href="3.gls.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="0.intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Estimating Covariance Structures and Generalised Least Squares - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="Estimating Covariance Structures and Generalised Least Squares - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="0.intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1.estimating-sigma.html">Estimating Covariance Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.covariance-solutions.html">Solutions for Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.gls.html">Generalised Least Squares (GLS)</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Using GLS in <code class="docutils literal notranslate"><span class="pre">R</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="5.gls-limitations.html">Limitations of the GLS Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="summary.html">Summary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/PCHN63112-Mixed-Models/estimating-covariance-gls" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/PCHN63112-Mixed-Models/estimating-covariance-gls/issues/new?title=Issue%20on%20page%20%2F4.gls-R.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/4.gls-R.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Using GLS in R</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-gls-one-way-anova">The GLS One-way ANOVA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-gls-syntax">The <code class="docutils literal notranslate"><span class="pre">gls()</span></code> Syntax</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-the-form-syntax">Understanding the <code class="docutils literal notranslate"><span class="pre">form=</span></code> Syntax</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-a-fully-unconstrained-covariance-structure">Specifying a Fully Unconstrained Covariance Structure</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inference-using-gls">Inference Using <code class="docutils literal notranslate"><span class="pre">gls()</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-tests">Coefficient Tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#omnibus-tests">Omnibus Tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#follow-up-tests">Follow-up Tests</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="using-gls-in-r">
<h1>Using GLS in <code class="docutils literal notranslate"><span class="pre">R</span></code><a class="headerlink" href="#using-gls-in-r" title="Link to this heading">#</a></h1>
<p>In the previous part of this lesson, we discussed the theory behind GLS. Now we turn to how GLS is implemented within <code class="docutils literal notranslate"><span class="pre">R</span></code>. We saw some examples of using the <code class="docutils literal notranslate"><span class="pre">gls()</span></code> function from <code class="docutils literal notranslate"><span class="pre">nlme</span></code> last semester. At that point, we only focused on the use of the <code class="docutils literal notranslate"><span class="pre">weights=</span></code> argument with different variance structures (e.g. <code class="docutils literal notranslate"><span class="pre">varIdent()</span></code>, <code class="docutils literal notranslate"><span class="pre">varPower()</span></code> etc.). However, there is also a <code class="docutils literal notranslate"><span class="pre">correlation=</span></code> argument that similarly takes a number of pre-specified correlation structures. We can use these two arguments together to form a final variance-covariance matrix that consists of <em>both</em> correlation and heterogenous variance groups. In this part of the lesson, we will explore <code class="docutils literal notranslate"><span class="pre">gls()</span></code> further using a simple repeated measures one-way ANOVA model. We will see examples of using <code class="docutils literal notranslate"><span class="pre">gls()</span></code> on more complex datasets in the workshop this week.</p>
<section id="the-gls-one-way-anova">
<h2>The GLS One-way ANOVA<a class="headerlink" href="#the-gls-one-way-anova" title="Link to this heading">#</a></h2>
<section id="the-data">
<h3>The Data<a class="headerlink" href="#the-data" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">datarium</span></code> package contains a dataset called <code class="docutils literal notranslate"><span class="pre">selfesteem</span></code> that contains measurements of a self-esteem score taken at 3 different time points per-subject. We can see how this is structured below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&#39;datarium&#39;</span><span class="p">)</span>
<span class="nf">data</span><span class="p">(</span><span class="s">&#39;selfesteem&#39;</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">selfesteem</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  id       t1       t2       t3
1  1 4.005027 5.182286 7.107831
2  2 2.558124 6.912915 6.308434
3  3 3.244241 4.443434 9.778410
4  4 3.419538 4.711696 8.347124
5  5 2.871243 3.908429 6.457287
6  6 2.045868 5.340549 6.653224
</pre></div>
</div>
</div>
</div>
<p>We can then convert it to long-format to make it suitable for univariate modelling</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&#39;reshape2&#39;</span><span class="p">)</span>

<span class="c1"># repeats and number of subjects</span>
<span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">3</span>
<span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">selfesteem</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span>

<span class="c1"># reshape wide -&gt; long</span>
<span class="n">selfesteem.long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">melt</span><span class="p">(</span><span class="n">selfesteem</span><span class="p">,</span><span class="w">            </span><span class="c1"># wide data frame</span>
<span class="w">                        </span><span class="n">id.vars</span><span class="o">=</span><span class="s">&#39;id&#39;</span><span class="p">,</span><span class="w">          </span><span class="c1"># what stays fixed?</span>
<span class="w">                        </span><span class="n">variable.name</span><span class="o">=</span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1"># name for the new predictor</span>
<span class="w">                        </span><span class="n">value.name</span><span class="o">=</span><span class="s">&quot;score&quot;</span><span class="p">)</span><span class="w">    </span><span class="c1"># name for the new outcome</span>

<span class="n">selfesteem.long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">selfesteem.long</span><span class="p">[</span><span class="nf">order</span><span class="p">(</span><span class="n">selfesteem.long</span><span class="o">$</span><span class="n">id</span><span class="p">),]</span><span class="w"> </span><span class="c1"># order by ID</span>
<span class="nf">rownames</span><span class="p">(</span><span class="n">selfesteem.long</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="n">n</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="w">                        </span><span class="c1"># fix row names</span>
<span class="n">selfesteem.long</span><span class="o">$</span><span class="n">id</span><span class="w">        </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">selfesteem.long</span><span class="o">$</span><span class="n">id</span><span class="p">)</span><span class="w">     </span><span class="c1"># convert ID to factor</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">selfesteem.long</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  id time    score
1  1   t1 4.005027
2  1   t2 5.182286
3  1   t3 7.107831
4  2   t1 2.558124
5  2   t2 6.912915
6  2   t3 6.308434
</pre></div>
</div>
</div>
</div>
<p>Our aim will be to look at different ways of modelling the covariance structure within this dataset, using GLS. In general, because there are 3 repeated measurements, the covariance matrix for each subject will be <span class="math notranslate nohighlight">\(3 \times 3\)</span>. Because we always assume that the subject are independent, we will be working with a block-diagonal structure of the form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\text{Var}\left(\boldsymbol{\epsilon}\right) = 
\begin{bmatrix}
    \boldsymbol{\Sigma}_{1} &amp; \mathbf{0}              &amp; \mathbf{0}              &amp; \cdots &amp; \mathbf{0}              \\
    \mathbf{0}              &amp; \boldsymbol{\Sigma}_{2} &amp; \mathbf{0}              &amp; \cdots &amp; \mathbf{0}              \\
    \mathbf{0}              &amp; \mathbf{0}              &amp; \boldsymbol{\Sigma}_{3} &amp; \cdots &amp; \mathbf{0}              \\
    \vdots                  &amp; \vdots                  &amp; \vdots                  &amp; \ddots &amp; \vdots                  \\          
    \mathbf{0}              &amp; \mathbf{0}              &amp; \mathbf{0}              &amp; \cdots &amp; \boldsymbol{\Sigma}_{n} \\
\end{bmatrix},
\end{split}\]</div>
<p>where each <span class="math notranslate nohighlight">\(\boldsymbol{\Sigma}_{i}\)</span> is an <em>identical</em> <span class="math notranslate nohighlight">\(3 \times 3\)</span> matrix and each <span class="math notranslate nohighlight">\(\mathbf{0}\)</span> is a <span class="math notranslate nohighlight">\(3 \times 3\)</span> matrix of zeros. As such, for subject <span class="math notranslate nohighlight">\(i\)</span>, our decisions centre on how the following matrix is parameterised</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\boldsymbol{\Sigma}_{i} = 
\begin{bmatrix}
    \sigma^{2}_{1} &amp; \sigma_{12}    &amp; \sigma_{13}    \\
    \sigma_{12}    &amp; \sigma^{2}_{2} &amp; \sigma_{23}    \\
    \sigma_{13}    &amp; \sigma_{23}    &amp; \sigma^{2}_{3} \\
\end{bmatrix}.
\end{split}\]</div>
</section>
<section id="the-gls-syntax">
<h3>The <code class="docutils literal notranslate"><span class="pre">gls()</span></code> Syntax<a class="headerlink" href="#the-gls-syntax" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">gls()</span></code> function is part of the <code class="docutils literal notranslate"><span class="pre">nlme</span></code> package and has a syntax very similar to <code class="docutils literal notranslate"><span class="pre">lm()</span></code>. The mean function is specified using the familiar formula syntax, so we can specify additive effects, interactions, polynomials and all the other complicated adjustments to the mean that we saw last semester. From this perspective, <code class="docutils literal notranslate"><span class="pre">gls()</span></code> and <code class="docutils literal notranslate"><span class="pre">lm()</span></code> can be treated as <em>identical</em>. Where the two functions differ is on the inclusion of a <code class="docutils literal notranslate"><span class="pre">weights=</span></code> argument and a <code class="docutils literal notranslate"><span class="pre">correlation=</span></code> argument. The <code class="docutils literal notranslate"><span class="pre">weights=</span></code> argument is used to affect the <em>variance</em> (the diagonal elements of <span class="math notranslate nohighlight">\(\boldsymbol{\Sigma}\)</span>), whereas the <code class="docutils literal notranslate"><span class="pre">correlation=</span></code> argument is used to affect the <em>covariance</em> (the off-diagonal elements of <span class="math notranslate nohighlight">\(\boldsymbol{\Sigma}\)</span>). These can either be used <em>independently</em>, or <em>together</em> depending on the type of covariance structure we want. We can also leave them out entirely, which will give us the same model as <code class="docutils literal notranslate"><span class="pre">lm()</span></code>, but estimated using REML rather than OLS.</p>
<p>In terms of how to use the <code class="docutils literal notranslate"><span class="pre">weights=</span></code> and <code class="docutils literal notranslate"><span class="pre">correlation=</span></code> arguments, they each need to be passed a special function that describes the structure we want the model to fit. These functions then take a <code class="docutils literal notranslate"><span class="pre">form=</span></code> argument that describes how we want that structure to be applied to our specific dataset. To see all the available variance functions, type <code class="docutils literal notranslate"><span class="pre">?varClasses</span></code> at the <code class="docutils literal notranslate"><span class="pre">R</span></code> prompt. Similarly, to see all the available correlation functions, type <code class="docutils literal notranslate"><span class="pre">?corClasses</span></code> at the <code class="docutils literal notranslate"><span class="pre">R</span></code> prompt. We will examine a few of these options below, as well as in the associated workshop.</p>
<p>In terms of specifying a GLS model that is equivalent to the classic repeated measures ANOVA, we can use the syntax</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&#39;nlme&#39;</span><span class="p">)</span>

<span class="n">gls.mod.CS</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gls</span><span class="p">(</span><span class="n">score</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">correlation</span><span class="o">=</span><span class="nf">corCompSymm</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="o">|</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">selfesteem.long</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here, we have specified <em>no</em> <code class="docutils literal notranslate"><span class="pre">weights=</span></code> argument, which means that <code class="docutils literal notranslate"><span class="pre">gls()</span></code> defaults to a single constant variance term. In terms of <code class="docutils literal notranslate"><span class="pre">correlation=</span></code>, we have used the <code class="docutils literal notranslate"><span class="pre">corCompSymm()</span></code> function which, as the name implies, gives us a <em>compound symmetric</em> covariance matrix. We will discuss the syntax used in <code class="docutils literal notranslate"><span class="pre">form=</span></code> further below. In brief, this is saying that we want a compound symmetric covariance structure to apply to each subject as a block. So we are implying a block-diagonal variance-covariance matrix, where each subject is a block and the structure within a block is compound symmetric.</p>
<p>So that we do not get distracted by <em>inference</em> just yet, we will just examine the model object, rather than calling <code class="docutils literal notranslate"><span class="pre">summary()</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">gls.mod.CS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generalized least squares fit by REML
  Model: score ~ time 
  Data: selfesteem.long 
  Log-restricted-likelihood: -38.00009

Coefficients:
(Intercept)      timet2      timet3 
   3.140122    1.793820    4.496220 

Correlation Structure: Compound symmetry
 Formula: ~1 | id 
 Parameter estimate(s):
       Rho 
-0.1765313 
Degrees of freedom: 30 total; 27 residual
Residual standard error: 0.8859852 
</pre></div>
</div>
</div>
</div>
<p>So, we can see some details about the REML fit at the top, followed by the parameter estimates for the mean function. This is the same as last semester, where <code class="docutils literal notranslate"><span class="pre">R</span></code> has created dummy variables to represent the factor <code class="docutils literal notranslate"><span class="pre">time</span></code>. The first level of <code class="docutils literal notranslate"><span class="pre">time</span></code> has been dropped, so now the <code class="docutils literal notranslate"><span class="pre">(Intercept)</span></code> parameter represents the mean at <code class="docutils literal notranslate"><span class="pre">time1</span></code>, whereas the two slopes represent the <em>difference</em> between <code class="docutils literal notranslate"><span class="pre">time1</span></code> and <code class="docutils literal notranslate"><span class="pre">time2</span></code>, and the <em>difference</em> between <code class="docutils literal notranslate"><span class="pre">time1</span></code> and <code class="docutils literal notranslate"><span class="pre">time3</span></code>.</p>
<p>Most importantly, is the information <em>below</em> this about the estimated correlation structure. So, we have a summary of what we requested followed by the <em>parameter estimates</em>. Because a compound symmetric structure consists of only a <em>single</em> constant correlation, we have <em>one</em> correlation parameter here (labelled <code class="docutils literal notranslate"><span class="pre">Rho</span></code> for the Greek letter <span class="math notranslate nohighlight">\(\rho\)</span>). So we can see that the constant correlation between time-points has been estimated as <span class="math notranslate nohighlight">\(\hat{\rho} = -0.18\)</span>. This is important to note because the correlation is <em>negative</em>. Remember from last week that under the repeated measures ANOVA, correlation is only allowed to be <em>positive</em>. So even though a compound symmetric structure remains a restrictive choice, an advantage of GLS is that it allows for the correlation to be <em>negative</em>.</p>
<p>Another advantage of GLS is that the covariance structure is estimated <em>explicitly</em>, rather than simply being <em>implied</em> by the algebra of the model. This means we can actually <em>look</em> at it. The <code class="docutils literal notranslate"><span class="pre">nlme</span></code> package comes with a function called <code class="docutils literal notranslate"><span class="pre">getVarCov()</span></code> which returns the estimated variance-covariance matrix. Because most of the time this is <em>block-diagonal</em> (and consists mainly of zeros), <code class="docutils literal notranslate"><span class="pre">getVarCov()</span></code> will only return a useful chunk of the matrix, rather than the whole thing. To determine which chunk to return, there is an <code class="docutils literal notranslate"><span class="pre">individual=</span></code> option where we give the <em>label</em> of whichever subject we want returned. Importantly, this corresponds to the labels of the factor we used to define the blocks. So, we need to refer to the result of calling</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">levels</span><span class="p">(</span><span class="n">selfesteem.long</span><span class="o">$</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [1] &quot;1&quot;  &quot;2&quot;  &quot;3&quot;  &quot;4&quot;  &quot;5&quot;  &quot;6&quot;  &quot;7&quot;  &quot;8&quot;  &quot;9&quot;  &quot;10&quot;
</pre></div>
</div>
</div>
</div>
<p>Here, the levels are just numbers turned into strings, but your own data may be different. So, if we provide one of the above labels to <code class="docutils literal notranslate"><span class="pre">getVarCov()</span></code> we will get the covariance structure for that single individual. Effectively this is <span class="math notranslate nohighlight">\(\hat{\boldsymbol{\Sigma}}_{i}\)</span> for a given subject. For example, the estimated covariance structure for the subject with <code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">=</span> <span class="pre">'1'</span></code> is</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">Sigma.i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">getVarCov</span><span class="p">(</span><span class="n">gls.mod.CS</span><span class="p">,</span><span class="w"> </span><span class="n">individual</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">Sigma.i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Marginal variance covariance matrix
         [,1]     [,2]     [,3]
[1,]  0.78497 -0.13857 -0.13857
[2,] -0.13857  0.78497 -0.13857
[3,] -0.13857 -0.13857  0.78497
  Standard Deviations: 0.88599 0.88599 0.88599 
</pre></div>
</div>
</div>
</div>
<p>So here we can actually <em>see</em> the compound symmetric structure, as all the diagonal elements are the same and all the off-diagonal elements are the same. Though, as highlighted above, the off-diagonal elements are allowed to be <em>negative</em>, unlike the repeated measures ANOVA.</p>
<p>It can also be useful to <em>visualise</em> this matrix, to make the structure clearer. To do so, we use the <code class="docutils literal notranslate"><span class="pre">Matrix</span></code> package and convert the output of <code class="docutils literal notranslate"><span class="pre">getVarCov()</span></code> to a <code class="docutils literal notranslate"><span class="pre">Matrix</span></code>. We can then visualise it with the <code class="docutils literal notranslate"><span class="pre">image</span></code> function<a class="footnote-reference brackets" href="#imagefunc-foot" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&#39;Matrix&#39;</span><span class="p">)</span>
<span class="nf">image</span><span class="p">(</span><span class="nf">as</span><span class="p">(</span><span class="n">Sigma.i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Matrix&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2ab3caf4ffd9d488c968743a68e740d2e418d3a4c5657f06d1bbe1109b62dbd7.png" src="_images/2ab3caf4ffd9d488c968743a68e740d2e418d3a4c5657f06d1bbe1109b62dbd7.png" />
</div>
</div>
</section>
<section id="understanding-the-form-syntax">
<h3>Understanding the <code class="docutils literal notranslate"><span class="pre">form=</span></code> Syntax<a class="headerlink" href="#understanding-the-form-syntax" title="Link to this heading">#</a></h3>
<p>As mentioned above, there are <em>two</em> parts to each of the correlation functions we can specify. The first is the actual structure, which is defined by the function itself (e.g. <code class="docutils literal notranslate"><span class="pre">corCompSymm()</span></code>, <code class="docutils literal notranslate"><span class="pre">corSymm()</span></code>, <code class="docutils literal notranslate"><span class="pre">corAR1()</span></code> etc.) The second, is the <code class="docutils literal notranslate"><span class="pre">form=</span></code> argument of that function, which defines how that structure is applied to this specific dataset. The syntax of the <code class="docutils literal notranslate"><span class="pre">form=</span></code> argument can take a little getting used to, but it is worth making an effort to understand because this is <em>the</em> way that the application of the given covariance structure is defined. As such, if we want to understand how to <em>speak</em> to <code class="docutils literal notranslate"><span class="pre">gls()</span></code> about what we want, we need to understand this.</p>
<p>The first element of <code class="docutils literal notranslate"><span class="pre">form=</span></code> to understand is the vertical bar <code class="docutils literal notranslate"><span class="pre">|</span></code>. This defines the <em>blocks</em> in a block-diagonal structure. This is <em>optional</em>, so if we do not want a block-diagonal covariance matrix, we do not use this. For repeated measures, we will almost always want this type of structure. To the <em>right</em> of the vertical bar is a <em>factor</em> whose levels define the blocks. In the example above, we used the factor <code class="docutils literal notranslate"><span class="pre">id</span></code> which has a level per-subject. So the subjects form the blocks. You can think of this as a way of carving up the dataset into specific <em>rows</em>. We are effectively saying “take the rows associated with each subject and apply the given covariance structure to those rows”.</p>
<p>Sticking with this idea, the value on the <em>left</em> of <code class="docutils literal notranslate"><span class="pre">|</span></code> specifies <em>how</em> to apply the covariance structure to those rows. If there is nothing else to do and we just want the covariance structure applied to the rows, we just put a <code class="docutils literal notranslate"><span class="pre">1</span></code> here. However, there may be cases where we want the given structure applied in a more complex way. As an example, we will take the <code class="docutils literal notranslate"><span class="pre">corSymm()</span></code> function, because this defines a <em>completely unstructured</em> covariance matrix. If we use <code class="docutils literal notranslate"><span class="pre">corSymm(form=</span> <span class="pre">~</span> <span class="pre">1|id)</span></code>, then we are saying “take the rows associated with each subject and estimate a completely unstructured covariance matrix using those rows”. This is fine, so long as we only have <em>one</em> measurement per-repeat, because each row then represents a <em>different condition</em>.</p>
<p>However, imagine a situation where we had <em>replications</em> of each condition within the data as well<a class="footnote-reference brackets" href="#reps-foot" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>. For instance, say each subject was measured 4 times at each time-point. In this situation, there is <em>additional structure</em> that needs to be included. Here, we can specify <code class="docutils literal notranslate"><span class="pre">form=</span> <span class="pre">~</span> <span class="pre">time|id</span></code>. This still defines a blocked structure, but within each block we are saying that the structure needs to be applied taking the variable <code class="docutils literal notranslate"><span class="pre">time</span></code> into account. To see this visually, the difference between using <code class="docutils literal notranslate"><span class="pre">corSymm(form=</span> <span class="pre">~</span> <span class="pre">time|id)</span></code> and <code class="docutils literal notranslate"><span class="pre">corSymm(form=</span> <span class="pre">~</span> <span class="pre">1|id)</span></code> is shown below. Hopefully it is clear that one structure is unconstrained, but is using the factor <code class="docutils literal notranslate"><span class="pre">time</span></code> to define the <em>occasions</em> over which that unconstrained structure is applied. The other is completely unconstrained, with no notion of <code class="docutils literal notranslate"><span class="pre">time</span></code> as an additional level of structure. The version on the <em>left</em> requires only 6 correlation parameters, whereas the version on the right requires 78 correlation parameters.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/c89152a55e0a8e0bc9362acc32cf6ff956a2bfcd65391b6f1516fe6754036e74.png" src="_images/c89152a55e0a8e0bc9362acc32cf6ff956a2bfcd65391b6f1516fe6754036e74.png" />
</div>
</div>
<p>Note that the effect of this syntax will depend upon the <em>type</em> of structure used. For instance, <code class="docutils literal notranslate"><span class="pre">corCompSymm()</span></code> will ignore anything other than a <code class="docutils literal notranslate"><span class="pre">1</span></code> on the left-hand side of <code class="docutils literal notranslate"><span class="pre">|</span></code>, because a compound symmetric structure only has a single correlation for all observations within a block. You <em>can</em> type <code class="docutils literal notranslate"><span class="pre">corCompSymm(form=</span> <span class="pre">~</span> <span class="pre">time|id)</span></code>, but it will not do anything. So, you need to think about the <em>structure</em> you are using, how the <em>blocks</em> are defined for that structure and then how that structure is defined <em>within</em> a block.</p>
</section>
<section id="specifying-a-fully-unconstrained-covariance-structure">
<h3>Specifying a Fully Unconstrained Covariance Structure<a class="headerlink" href="#specifying-a-fully-unconstrained-covariance-structure" title="Link to this heading">#</a></h3>
<p>In the example above, we stuck to the restrictive assumptions of the repeated measures ANOVA and specified a covariance structure that was <em>compound symmetric</em>. Although slightly advantageous, because we allowed for negative correlation, the whole point of the GLS framework is that we can lift this assumption entirely and specify something more complex. So, we will now consider a <em>completely unconstrained</em> covariance structure, where all correlations <em>and</em> all variances are free to vary. Note that this is the <em>opposite extreme</em> to the repeated measures ANOVA. There may well be a more appropriate structure available that is somewhere in between. For now, we will just focus on the unconstrained structure. In the accompanying workshop, we will examine some alternatives as well as how to use <em>model comparisons</em> to choose between them.</p>
<p>In order to specify a completely unconstrained structure, we need to combine both the <code class="docutils literal notranslate"><span class="pre">correlation=</span></code> option and the <code class="docutils literal notranslate"><span class="pre">weights=</span></code> option. Both of these take a <code class="docutils literal notranslate"><span class="pre">form=</span></code> argument, structured in the same way as above. For the correlation, we can use <code class="docutils literal notranslate"><span class="pre">corSymm(form=</span> <span class="pre">~</span> <span class="pre">1|id)</span></code>. This specifies a block-diagonal correlation structure, where each block consists of a completely unstructured correlation matrix. Because we have no replications within the repeated measurements, we need no additional structure beyond just providing a <code class="docutils literal notranslate"><span class="pre">1</span></code> on the left of <code class="docutils literal notranslate"><span class="pre">|</span></code>.</p>
<p>For the variance, we can use <code class="docutils literal notranslate"><span class="pre">varIdent(form=</span> <span class="pre">~</span> <span class="pre">1|time)</span></code>. The <code class="docutils literal notranslate"><span class="pre">varIdent()</span></code> function defines a <em>constant</em> variance. If we leave this with <em>no</em> <code class="docutils literal notranslate"><span class="pre">form=</span></code> argument, it will do nothing different to a normal linear model with a single variance term. However, we can use <code class="docutils literal notranslate"><span class="pre">form=</span></code> to specify a blocked structure where a <em>different</em> constant variance is estimated separately within each block. By specifying <code class="docutils literal notranslate"><span class="pre">form=</span> <span class="pre">~</span> <span class="pre">1|time</span></code>, we are effectively saying “take the rows associated with each time point separately and estimate a constant variance”. This allows each time point to have a separate variance, which means that the diagonal elements of the covariance structure can also vary.</p>
<p>The full model is therefore</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">gls.mod.UC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gls</span><span class="p">(</span><span class="n">score</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span>
<span class="w">                  </span><span class="n">correlation</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nf">corSymm</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="o">|</span><span class="n">id</span><span class="p">),</span><span class="w"> </span>
<span class="w">                  </span><span class="n">weights</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nf">varIdent</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="o">|</span><span class="n">time</span><span class="p">),</span><span class="w"> </span>
<span class="w">                  </span><span class="n">data</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">selfesteem.long</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>with an output given by</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="n">gls.mod.UC</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generalized least squares fit by REML
  Model: score ~ time 
  Data: selfesteem.long 
  Log-restricted-likelihood: -34.17924

Coefficients:
(Intercept)      timet2      timet3 
   3.140122    1.793820    4.496220 

Correlation Structure: General
 Formula: ~1 | id 
 Parameter estimate(s):
 Correlation: 
  1      2     
2 -0.267       
3  0.361 -0.523
Variance function:
 Structure: Different standard deviations per stratum
 Formula: ~1 | time 
 Parameter estimates:
      t1       t2       t3 
1.000000 1.564082 2.070649 
Degrees of freedom: 30 total; 27 residual
Residual standard error: 0.5518062 
</pre></div>
</div>
</div>
</div>
<p>where we can see both the 3 correlation parameters that have been estimated, as well as the 3 variance parameters that have been estimated. We can then view and visualise the individual covariance structures as before</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">Sigma.i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">getVarCov</span><span class="p">(</span><span class="n">gls.mod.UC</span><span class="p">,</span><span class="w"> </span><span class="n">individual</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">Sigma.i</span><span class="p">)</span>
<span class="nf">image</span><span class="p">(</span><span class="nf">as</span><span class="p">(</span><span class="n">Sigma.i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Matrix&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Marginal variance covariance matrix
         [,1]     [,2]     [,3]
[1,]  0.30449 -0.12729  0.22736
[2,] -0.12729  0.74489 -0.51578
[3,]  0.22736 -0.51578  1.30550
  Standard Deviations: 0.55181 0.86307 1.1426 
</pre></div>
</div>
<img alt="_images/49a2b35fcc89cecc212ebc42f88f319b4830332f6e4c50f59523cb1158a81cbf.png" src="_images/49a2b35fcc89cecc212ebc42f88f319b4830332f6e4c50f59523cb1158a81cbf.png" />
</div>
</div>
<p>So, we can see how this syntax has allowed <em>both</em> the correlation to be unconstrained and the variances to be unconstrained. This is the <em>most general</em> covariance structure we can have for this dataset and thus represents the <em>most flexible</em> alternative to the repeated measures ANOVA.</p>
</section>
</section>
<section id="inference-using-gls">
<h2>Inference Using <code class="docutils literal notranslate"><span class="pre">gls()</span></code><a class="headerlink" href="#inference-using-gls" title="Link to this heading">#</a></h2>
<p>Although at this point we should assess the assumptions of the GLS model, we will leave this to one side and come back to it during the workshop this week. Our focus for now is the thorny topic of <em>inference</em> using a <code class="docutils literal notranslate"><span class="pre">gls()</span></code> model. Before digging into this, you may want to quickly remind yourself of the “solutions” discussed earlier in this lesson. Our aim here is to indicate which of these solutions are available within the various functions we have used previously when models were fit with <code class="docutils literal notranslate"><span class="pre">lm()</span></code>.</p>
<section id="coefficient-tests">
<h3>Coefficient Tests<a class="headerlink" href="#coefficient-tests" title="Link to this heading">#</a></h3>
<p>To start of with, we will examine the inferential tests provided when we call <code class="docutils literal notranslate"><span class="pre">summary()</span></code> on a <code class="docutils literal notranslate"><span class="pre">gls()</span></code> model object. Using the one-way ANOVA model with the unconstrained covariance structure, we have</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">gls.mod.UC</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generalized least squares fit by REML
  Model: score ~ time 
  Data: selfesteem.long 
       AIC      BIC    logLik
  86.35848 98.02101 -34.17924

Correlation Structure: General
 Formula: ~1 | id 
 Parameter estimate(s):
 Correlation: 
  1      2     
2 -0.267       
3  0.361 -0.523
Variance function:
 Structure: Different standard deviations per stratum
 Formula: ~1 | time 
 Parameter estimates:
      t1       t2       t3 
1.000000 1.564082 2.070649 

Coefficients:
               Value Std.Error   t-value p-value
(Intercept) 3.140122 0.1744964 17.995335       0
timet2      1.793820 0.3611027  4.967618       0
timet3      4.496220 0.3398979 13.228147       0

 Correlation: 
       (Intr) timet2
timet2 -0.685       
timet3 -0.130 -0.254

Standardized residuals:
        Min          Q1         Med          Q3         Max 
-1.98304032 -0.64457676 -0.05166722  0.65547940  2.29294653 

Residual standard error: 0.5518062 
Degrees of freedom: 30 total; 27 residual
</pre></div>
</div>
</div>
</div>
<p>where we now have a table of coefficients, similar in spirit to those from an <code class="docutils literal notranslate"><span class="pre">lm()</span></code> model<a class="footnote-reference brackets" href="#glsp-foot" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>. However, notice that these are given as <span class="math notranslate nohighlight">\(t\)</span>-statistics <em>not</em> <span class="math notranslate nohighlight">\(z\)</span>-statistics. So this is <em>not</em> asymptotic inference (solution <strong>1b</strong> from earlier). In addition, notice that the <code class="docutils literal notranslate"><span class="pre">Degrees</span> <span class="pre">of</span> <span class="pre">freedom</span></code> listed at the bottom are calculated as the <em>total</em> amount of data (<span class="math notranslate nohighlight">\(n \times t = 10 \times 3 = 30\)</span>) minus the 3 parameters for the mean function. So, this is <em>not</em> using effective degrees of freedom (solution <strong>2</strong> from earlier) because the 6 parameters used to estimate the covariance structure are being <em>ignored</em>. So, what <code class="docutils literal notranslate"><span class="pre">summary()</span></code> is doing here is solution <strong>1a</strong>: treating <span class="math notranslate nohighlight">\(\boldsymbol{\Sigma}\)</span> as <em>known</em> and ignoring everything else.</p>
<p>The key to understanding <em>why</em> <code class="docutils literal notranslate"><span class="pre">summary()</span></code> behaves in this way is that the <code class="docutils literal notranslate"><span class="pre">gls()</span></code> function is designed to act <em>as if</em> we were using GLS instead of FGLS. Indeed, all of the <code class="docutils literal notranslate"><span class="pre">weights=</span></code> and <code class="docutils literal notranslate"><span class="pre">correlation=</span></code> functions will take values for the parameters so that <em>pre-specified</em> structures can be used in the call to <code class="docutils literal notranslate"><span class="pre">gls()</span></code>. This was the <em>original intent</em> of the function. The ability to <em>estimate</em> the structure from the data (and thus switch to FGLS) was a <em>practical</em> inclusion, but not one that <code class="docutils literal notranslate"><span class="pre">summary()</span></code> adjusts for. Once we understand this, the behaviour of <code class="docutils literal notranslate"><span class="pre">gls()</span></code> makes complete sense. However, we need to be mindful of all the consequences of this, as listed earlier in the lesson.</p>
</section>
<section id="omnibus-tests">
<h3>Omnibus Tests<a class="headerlink" href="#omnibus-tests" title="Link to this heading">#</a></h3>
<p>Although the tests returned by <code class="docutils literal notranslate"><span class="pre">summary()</span></code> are somewhat problematic, the extent to which this matters depends on our intention for the model. As we know from last semester, under a typical ANOVA scheme the individual coefficients tests are not particularly interesting because they depend upon the type of dummy variable scheme used. As such, we tend to rely on <em>omnibus</em> tests with specific <em>follow-up</em> tests instead. So, for the one-way ANOVA model with an unconstrained covariance structure, we can again turn to <code class="docutils literal notranslate"><span class="pre">Anova()</span></code> from the <code class="docutils literal notranslate"><span class="pre">car</span></code> package to produce our Type II omnibus ANOVA tests.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&#39;car&#39;</span><span class="p">)</span>
<span class="nf">Anova</span><span class="p">(</span><span class="n">gls.mod.UC</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Analysis of Deviance Table (Type II tests)

Response: score
     Df  Chisq Pr(&gt;Chisq)    
time  2 249.03  &lt; 2.2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre></div>
</div>
</div>
</div>
<p>Notice, however, that this does <em>not</em> provide an <span class="math notranslate nohighlight">\(F\)</span>-statistic with denominator degrees of freedom, so this is neither solution <strong>1a</strong> nor solution <strong>2</strong> from earlier. Instead, <code class="docutils literal notranslate"><span class="pre">Anova()</span></code> relies on <em>asymptotic</em> tests for omnibus inference. So, interpreting this test involves accepting that the <span class="math notranslate nohighlight">\(p\)</span>-value will only be <em>asymptotically</em> correct, getting more accurate the larger the sample becomes. In this example, we only have <span class="math notranslate nohighlight">\(n = 10\)</span>, which should make us very cautious about interpreting this test. However, the <span class="math notranslate nohighlight">\(p\)</span>-value is <em>so small</em> (<span class="math notranslate nohighlight">\(p &lt; 0.00000000000000022\)</span>) that even if it were <em>liberal</em> under small samples, it would have to be <em>catastrophically liberal</em> in order for a <em>non-significant</em> effect to be <em>this significant</em> due to sample size alone. In this case, we probably feel fairly confident that <em>something</em> is going on, even under asymptotic assumptions.</p>
</section>
<section id="follow-up-tests">
<h3>Follow-up Tests<a class="headerlink" href="#follow-up-tests" title="Link to this heading">#</a></h3>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="imagefunc-foot" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Note that both base <code class="docutils literal notranslate"><span class="pre">R</span></code> and the <code class="docutils literal notranslate"><span class="pre">Matrix</span></code> package have functions called <code class="docutils literal notranslate"><span class="pre">image</span></code>. <code class="docutils literal notranslate"><span class="pre">R</span></code> will usually try to infer which one you want to use (and will usually print a warning about one function being <em>masked</em> by another). However, if you want to be <em>explicit</em> about this, you can prepend the function with the package name like this: <code class="docutils literal notranslate"><span class="pre">Matrix::image()</span></code> or <code class="docutils literal notranslate"><span class="pre">graphics::image()</span></code>.</p>
</aside>
<aside class="footnote brackets" id="reps-foot" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>This is an unusual situation in psychological experiments, not because replications do not exists (they almost always do) but because psychologists will usually just average-over them as part of the pre-processing of their data. This is a habit that comes <em>directly</em> from needing data that fits with the traditional repeated measures ANOVA. However, this is not only unnecessary with modern methods, but is actively <em>throwing away</em> information that the model can use. This is perhaps <em>less important</em> with GLS, but is potentially <em>very important</em> with mixed-effects.</p>
</aside>
<aside class="footnote brackets" id="glsp-foot" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>Notice that the <span class="math notranslate nohighlight">\(p\)</span>-values have been <em>rounded</em> here, rather than given in scientific notation. So these are not <em>literally</em> 0, they are just so small that they have been rounded to 0. Whenever the <code class="docutils literal notranslate"><span class="pre">summary()</span></code> table for <code class="docutils literal notranslate"><span class="pre">gls()</span></code> shows <code class="docutils literal notranslate"><span class="pre">0</span></code>, just take it to mean <span class="math notranslate nohighlight">\(p &lt; 0.001\)</span>.</p>
</aside>
</aside>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="3.gls.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Generalised Least Squares (GLS)</p>
      </div>
    </a>
    <a class="right-next"
       href="5.gls-limitations.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Limitations of the GLS Framework</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-gls-one-way-anova">The GLS One-way ANOVA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-gls-syntax">The <code class="docutils literal notranslate"><span class="pre">gls()</span></code> Syntax</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-the-form-syntax">Understanding the <code class="docutils literal notranslate"><span class="pre">form=</span></code> Syntax</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-a-fully-unconstrained-covariance-structure">Specifying a Fully Unconstrained Covariance Structure</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inference-using-gls">Inference Using <code class="docutils literal notranslate"><span class="pre">gls()</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-tests">Coefficient Tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#omnibus-tests">Omnibus Tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#follow-up-tests">Follow-up Tests</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dr Martyn McFarquhar
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2026.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>